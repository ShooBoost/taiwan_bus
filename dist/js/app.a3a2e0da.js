(function(e){function t(t){for(var n,c,i=t[0],s=t[1],u=t[2],f=0,p=[];f<i.length;f++)c=i[f],Object.prototype.hasOwnProperty.call(o,c)&&o[c]&&p.push(o[c][0]),o[c]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);l&&l(t);while(p.length)p.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,i=1;i<r.length;i++){var s=r[i];0!==o[s]&&(n=!1)}n&&(a.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},o={app:0},a=[];function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/taiwan_bus/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=s;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},1:function(e,t){},5280:function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("6cc5");var n=r("7a23"),o={class:"flex flex-direction-column h100 pos-relative"},a={id:"nav",class:"w40-md w30-lg bg-color-white display-none display-block-md pos-absolute z-index99999 border-bottom-grey520"},c={class:"flex color-white jc-space-around ai-center"},i={class:"w100 text-center"},s=Object(n["g"])("directions_bus_filled"),u={class:"w100 text-center"},l={class:"w100 text-center"},f={class:"footer bg-color-white border-box pos-relative display-none-md border-top-grey520"},p={class:"flex h100 color-white jc-space-around ai-center"},h={class:"w100 text-center"},b=Object(n["g"])("directions_bus_filled"),d={class:"w100 text-center"},m={class:"w100 text-center"};function O(e,t,r,O,v,g){var w=Object(n["w"])("router-link"),j=Object(n["w"])("router-view");return Object(n["r"])(),Object(n["e"])("div",o,[Object(n["f"])("header",a,[Object(n["f"])("ul",c,[Object(n["f"])("li",i,[Object(n["h"])(w,{to:"/",class:Object(n["n"])(["border-box w100 p12 fz32 bg-white-color-primary",{"material-icons-round":v.showHome,"material-icons-outlined":!v.showHome}])},{default:Object(n["C"])((function(){return[s]})),_:1},8,["class"])]),Object(n["f"])("li",u,[Object(n["h"])(w,{to:"?routes=favorite",class:"material-icons-outlined border-box w100 p12 fz32 bg-white-color-primary"},{default:Object(n["C"])((function(){return[Object(n["g"])(Object(n["y"])(v.favoriteBorderOrFill),1)]})),_:1})]),Object(n["f"])("li",l,[Object(n["f"])("span",{onClick:t[0]||(t[0]=function(){return g.shareUrl&&g.shareUrl.apply(g,arguments)}),class:"material-icons-outlined border-box w100 p12 fz32 cursor-pointer bg-white-color-primary"}," link ")])])]),Object(n["h"])(j,{class:"w100 flex-grow-1 overflow-scroll"}),Object(n["f"])("footer",f,[Object(n["f"])("ul",p,[Object(n["f"])("li",h,[Object(n["h"])(w,{to:"/",class:Object(n["n"])(["border-box w100 p12 fz32 bg-white-color-primary",{"material-icons-round":v.showHome,"material-icons-outlined":!v.showHome}])},{default:Object(n["C"])((function(){return[b]})),_:1},8,["class"])]),Object(n["f"])("li",d,[Object(n["h"])(w,{to:"?routes=favorite",class:"material-icons-outlined border-box w100 p12 fz32 bg-white-color-primary"},{default:Object(n["C"])((function(){return[Object(n["g"])(Object(n["y"])(v.favoriteBorderOrFill),1)]})),_:1})]),Object(n["f"])("li",m,[Object(n["f"])("span",{onClick:t[1]||(t[1]=function(){return g.shareUrl&&g.shareUrl.apply(g,arguments)}),class:"material-icons-outlined border-box w100 p12 fz32 cursor-pointer bg-white-color-primary"}," ios_share ")])])])])}var v=r("1da1"),g=(r("96cf"),{data:function(){return{showHome:"favorite"!==this.$route.query.routes,favoriteBorderOrFill:"favorite"===this.$route.query.routes?"favorite":"favorite_border"}},watch:{showHome:function(){this.favoriteBorderOrFill=this.showHome?"favorite_border":"favorite"},"$route.query":{handler:function(e){this.showHome="favorite"!==e.routes},deep:!0}},methods:{shareUrl:function(e){var t=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:navigator.share?navigator.share({title:"台灣公車查詢",text:"網頁連結:",url:t.$route.fullPath}).then((function(){console.log("成功！")})).catch((function(e){console.log("發生錯誤",e)})):(navigator.clipboard.writeText(window.location.href),n=e.target.textContent,e.target.classList.remove("fz32"),e.target.classList.add("fz20"),e.target.classList.add("pointer-event-none"),e.target.classList.remove("pointer-event-initial"),e.target.textContent="網址複製成功",setTimeout((function(){e.target.textContent=n,e.target.classList.add("fz32"),e.target.classList.remove("fz20"),e.target.classList.add("pointer-event-initial"),e.target.classList.remove("pointer-event-none")}),2e3));case 1:case"end":return r.stop()}}),r)})))()}},created:function(){}}),w=(r("ebf0"),r("6b0d")),j=r.n(w);const x=j()(g,[["render",O]]);var R=x,y=r("6c02"),C=(r("b64b"),r("d3b7"),r("25f0"),r("fb6a"),{class:"flex-md w100 pos-relative border-box"}),S={id:"infoPanel",class:"w100 w40-md w30-lg h90 h100-md pos-absolute pos-relative-md b0 z-index9999 bg-color-white flex flex-direction-column border-rounded-top-24 border-rounded-none-md pt68-md border-box"},N={class:"px32"},k={key:0,class:"text-center pt12"},D={class:"w100 py12 px22 border-box fz20"},T={class:"w100 gap10 flex jc-space-around mb10"},I={class:"w100 gap10 flex jc-space-around mb10"},A={class:"w100 gap10 flex jc-space-around mb10"},E={class:"w100 gap10 flex jc-space-around"},F={key:1,class:"overflow-scroll flex-grow-1"},P={class:"w100 w60-md w70-lg h100"};function B(e,t,r,o,a,c){var i=Object(n["w"])("RouteSearchPanel"),s=Object(n["w"])("StopsListPanel"),u=Object(n["w"])("Map");return Object(n["r"])(),Object(n["e"])("div",C,[Object(n["f"])("section",S,[Object(n["f"])("div",{onTouchstart:t[0]||(t[0]=Object(n["E"])((function(){return c.setOriginalClientY&&c.setOriginalClientY.apply(c,arguments)}),["prevent","self"])),onTouchmove:t[1]||(t[1]=Object(n["E"])((function(){return c.changeTargetHeight&&c.changeTargetHeight.apply(c,arguments)}),["prevent","self"])),onTouchend:t[2]||(t[2]=Object(n["E"])((function(e){return a.touchingInfoPanelOrNot=!1}),["prevent","self"])),onMousedown:t[3]||(t[3]=Object(n["E"])((function(){return c.setOriginalClientY&&c.setOriginalClientY.apply(c,arguments)}),["prevent","self"])),onMousemove:t[4]||(t[4]=Object(n["E"])((function(){return c.changeTargetHeight&&c.changeTargetHeight.apply(c,arguments)}),["prevent","self"])),onMouseup:t[5]||(t[5]=Object(n["E"])((function(e){return a.touchingInfoPanelOrNot=!1}),["prevent"])),class:"py12 text-center material-icons-round fw-bold cursor-pointer display-none-md"}," horizontal_rule ",32),0===Object.keys(e.chosenDirection).length?(Object(n["r"])(),Object(n["e"])("div",{key:0,class:Object(n["n"])(["flex flex-direction-column overflow-scroll flex-grow-1",{"jc-center":c.signOfEmptyFavoriteRoute}])},[Object(n["f"])("div",N,[Object(n["D"])(Object(n["f"])("input",{id:"inputOfSearchRoute",class:"w100 border-box mb20 bg-color-grey300 border-none p12 border-rounded-10-md","onUpdate:modelValue":t[6]||(t[6]=function(e){return c.routeName=e}),placeholder:"🔍"},null,512),[[n["A"],c.routeName]])]),"favorite"===e.$route.query.routes&&c.signOfEmptyFavoriteRoute?(Object(n["r"])(),Object(n["e"])("p",k,Object(n["y"])(c.signOfEmptyFavoriteRoute),1)):Object(n["d"])("",!0),Object(n["h"])(i,{class:"overflow-scroll flex-grow-1"}),Object(n["f"])("div",D,[Object(n["f"])("div",T,[Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-kb-red color-white fw-bold cursor-pointer",onClick:t[7]||(t[7]=function(e){return c.routeName=c.routeName.toString()+"紅"})}," 紅 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-kb-blue color-white fw-bold cursor-pointer",onClick:t[8]||(t[8]=function(e){return c.routeName=c.routeName.toString()+"藍"})}," 藍 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[9]||(t[9]=function(e){return c.routeName=c.routeName.toString()+"1"})}," 1 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[10]||(t[10]=function(e){return c.routeName=c.routeName.toString()+"2"})}," 2 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[11]||(t[11]=function(e){return c.routeName=c.routeName.toString()+"3"})}," 3 ")]),Object(n["f"])("div",I,[Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-kb-green color-white fw-bold cursor-pointer",onClick:t[12]||(t[12]=function(e){return c.routeName=c.routeName.toString()+"綠"})}," 綠 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-kb-brown color-white fw-bold cursor-pointer",onClick:t[13]||(t[13]=function(e){return c.routeName=c.routeName.toString()+"棕"})}," 棕 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[14]||(t[14]=function(e){return c.routeName=c.routeName.toString()+"4"})}," 4 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[15]||(t[15]=function(e){return c.routeName=c.routeName.toString()+"5"})}," 5 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[16]||(t[16]=function(e){return c.routeName=c.routeName.toString()+"6"})}," 6 ")]),Object(n["f"])("div",A,[Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-kb-orange color-white fw-bold cursor-pointer",onClick:t[17]||(t[17]=function(e){return c.routeName=c.routeName.toString()+"橘"})}," 橘 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-kb-yellow color-white fw-bold cursor-pointer",onClick:t[18]||(t[18]=function(e){return c.routeName=c.routeName.toString()+"黃"})}," 黃 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[19]||(t[19]=function(e){return c.routeName=c.routeName.toString()+"7"})}," 7 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[20]||(t[20]=function(e){return c.routeName=c.routeName.toString()+"8"})}," 8 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[21]||(t[21]=function(e){return c.routeName=c.routeName.toString()+"9"})}," 9 ")]),Object(n["f"])("div",E,[Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey600 color-white fw-bold cursor-pointer",onClick:t[22]||(t[22]=function(e){return c.routeName=c.routeName.toString()+"F"})}," F "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey600 color-white fw-bold cursor-pointer",onClick:t[23]||(t[23]=function(e){return c.routeName=c.routeName.toString()+"小"})}," 小 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-kb-black color-white cursor-pointer",onClick:t[24]||(t[24]=function(e){return c.focusInput("inputOfSearchRoute")})}," 其他 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[25]||(t[25]=function(e){return c.routeName=c.routeName.toString()+"0"})}," 0 "),Object(n["f"])("div",{class:"py12 border-rounded w100 text-center bg-color-grey500 cursor-pointer",onClick:t[26]||(t[26]=function(e){return c.routeName=c.routeName.toString().slice(0,-1)})}," 清除 ")])])],2)):(Object(n["r"])(),Object(n["e"])("div",F,[Object(n["h"])(s,{class:"h100",prePage:a.nowPage,onChangeDirection:c.changeDirectionForMap,onRenewFavoriteRoutes:c.renewFavoriteRoutes},null,8,["prePage","onChangeDirection","onRenewFavoriteRoutes"])]))]),Object(n["f"])("section",P,[Object(n["h"])(u,{class:"w100 h100",mapId:"homeMap"})])])}var H=r("5530"),U=(r("7db0"),r("159b"),r("4de4"),r("2909")),_=r("b85c"),Z=(r("99af"),r("4e82"),r("a15b"),r("3ca3"),r("ddb0"),r("4328")),q=r.n(Z),z=r("bc3a"),J=r.n(z),M={data:function(){return{}},methods:{getCityList:function(){var e=this;return Object(v["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="https://tdx.transportdata.tw/api/basic/v2/Basic/City?%24format=JSON",t.prev=1,t.t0=J.a,t.t1=r,t.next=6,e.getAuthorizationHeader();case 6:return t.t2=t.sent,t.t3={headers:t.t2},t.next=10,t.t0.get.call(t.t0,t.t1,t.t3);case 10:return n=t.sent,t.next=13,n.data;case 13:return t.abrupt("return",t.sent);case 16:t.prev=16,t.t4=t["catch"](1),console.log("台灣所有縣市的名稱",t.t4);case 19:case"end":return t.stop()}}),t,null,[[1,16]])})))()},getAuthorizationHeader:function(){return Object(v["a"])(regeneratorRuntime.mark((function e(){var t,r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={grant_type:"client_credentials",client_id:"shooboost-0659506a-9440-4f49",client_secret:"f075a3b1-3567-47d5-9926-e413ba6d3d42"},r="https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",e.prev=2,e.next=5,J()({method:"POST",url:r,data:q.a.stringify(t),headers:{"content-type":"application/x-www-form-urlencoded"}});case 5:return n=e.sent,o=n.data,e.abrupt("return",{authorization:"Bearer ".concat(o.access_token)});case 10:return e.prev=10,e.t0=e["catch"](2),e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))()},getRoutesOfTheCity:function(e,t){var r=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var o,a,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o="https://tdx.transportdata.tw/api/basic/v2/Bus/Route/City/".concat(e,"?$format=JSON"),n.prev=1,n.t0=J.a,n.t1="".concat(o),n.next=6,r.getAuthorizationHeader();case 6:return n.t2=n.sent,n.t3={headers:n.t2},n.next=10,n.t0.get.call(n.t0,n.t1,n.t3);case 10:return a=n.sent,c=[],a.data.forEach((function(e){c.push({City:e.City,CityName:t,CityCode:e.CityCode,RouteUID:e.RouteUID,RouteMapImageUrl:e.RouteMapImageUrl,RouteName:e.RouteName,DepartureStopNameEn:e.DepartureStopNameEn,DepartureStopNameZh:e.DepartureStopNameZh,DestinationStopNameEn:e.DestinationStopNameEn,DestinationStopNameZh:e.DestinationStopNameZh})})),n.next=15,c;case 15:return n.abrupt("return",n.sent);case 18:n.prev=18,n.t4=n["catch"](1),console.log(n.t4);case 21:case"end":return n.stop()}}),n,null,[[1,18]])})))()},getRoutesOfTaiwan:function(e){var t=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var n,o,a,c,i,s,u,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=[],o=[],a=Object(_["a"])(e),r.prev=3,a.s();case 5:if((c=a.n()).done){r.next=14;break}return i=c.value,r.t0=o,r.next=10,t.getRoutesOfTheCity(i.City,i.CityName);case 10:r.t1=r.sent,r.t0.push.call(r.t0,r.t1);case 12:r.next=5;break;case 14:r.next=19;break;case 16:r.prev=16,r.t2=r["catch"](3),a.e(r.t2);case 19:return r.prev=19,a.f(),r.finish(19);case 22:s=0,u=o;case 23:if(!(s<u.length)){r.next=33;break}return l=u[s],r.t3=n,r.next=28,l;case 28:r.t4=r.sent,n=r.t3.concat.call(r.t3,r.t4);case 30:s++,r.next=23;break;case 33:return n.sort((function(e,t){return e.RouteName.Zh_tw.localeCompare(t.RouteName.Zh_tw,"zh-TW")})),r.next=36,n;case 36:return r.abrupt("return",r.sent);case 37:case"end":return r.stop()}}),r,null,[[3,16,19,22]])})))()},getVehicleNearStopOfTheRoute:function(e,t){var r=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var o,a,c,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=["RouteName","Direction","RouteUID","StopUID","PlateNumb","A2EventType","StopName","SubRouteUID"],a=o.join("%2C"),c="https://tdx.transportdata.tw/api/basic/v2/Bus/RealTimeNearStop/City/".concat(e,"/").concat(t,"?$select=").concat(a,"&$format=JSON"),n.prev=3,n.t0=J.a,n.t1="".concat(c),n.next=8,r.getAuthorizationHeader();case 8:return n.t2=n.sent,n.t3={headers:n.t2},n.next=12,n.t0.get.call(n.t0,n.t1,n.t3);case 12:return i=n.sent,n.next=15,i.data;case 15:return n.abrupt("return",n.sent);case 18:n.prev=18,n.t4=n["catch"](3),console.log(n.t4);case 21:case"end":return n.stop()}}),n,null,[[3,18]])})))()},getVehicleOfTheCity:function(e){var t=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n="https://tdx.transportdata.tw/api/basic/v2/Bus/Vehicle/City/".concat(e,"?$filter=VehicleType%20eq%201&$format=JSON/"),r.prev=1,r.t0=J.a,r.t1="".concat(n),r.next=6,t.getAuthorizationHeader();case 6:return r.t2=r.sent,r.t3={headers:r.t2},r.next=10,r.t0.get.call(r.t0,r.t1,r.t3);case 10:return o=r.sent,r.next=13,o.data;case 13:return r.abrupt("return",r.sent);case 16:r.prev=16,r.t4=r["catch"](1),console.log(r.t4);case 19:case"end":return r.stop()}}),r,null,[[1,16]])})))()},getVehicleOfTaiwan:function(e){var t=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var n,o,a,c,i,s,u,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=[],o=[],a=Object(_["a"])(e),r.prev=3,a.s();case 5:if((c=a.n()).done){r.next=16;break}if(i=c.value,"Chiayi"!==i.City){r.next=9;break}return r.abrupt("continue",14);case 9:return r.t0=o,r.next=12,t.getVehicleOfTheCity(i.City);case 12:r.t1=r.sent,r.t0.push.call(r.t0,r.t1);case 14:r.next=5;break;case 16:r.next=21;break;case 18:r.prev=18,r.t2=r["catch"](3),a.e(r.t2);case 21:return r.prev=21,a.f(),r.finish(21);case 24:s=0,u=o;case 25:if(!(s<u.length)){r.next=35;break}return l=u[s],r.t3=n,r.next=30,l;case 30:r.t4=r.sent,n=r.t3.concat.call(r.t3,r.t4);case 32:s++,r.next=25;break;case 35:return r.next=37,n;case 37:return r.abrupt("return",r.sent);case 38:case"end":return r.stop()}}),r,null,[[3,18,21,24]])})))()},getRouteGEOJSON:function(e,t){var r=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o="https://tdx.transportdata.tw/api/basic/V3/Map/Bus/Network/StopOfRoute/City/".concat(e,"/RouteName/").concat(t,"?%24format=GEOJSON"),n.prev=1,n.t0=J.a,n.t1="".concat(o),n.next=6,r.getAuthorizationHeader();case 6:return n.t2=n.sent,n.t3={headers:n.t2},n.next=10,n.t0.get.call(n.t0,n.t1,n.t3);case 10:return a=n.sent,console.log("getRouteGEOJSON 拿到 tdx data 啦",o,a.data),n.abrupt("return",a.data.features[0]);case 15:n.prev=15,n.t4=n["catch"](1),console.log(n.t4);case 18:case"end":return n.stop()}}),n,null,[[1,15]])})))()},getStopsOfTheRoute:function(e,t,r){var n=this;return Object(v["a"])(regeneratorRuntime.mark((function o(){var a,c;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a="https://tdx.transportdata.tw/api/basic/v2/Bus/StopOfRoute/City/".concat(e,"/").concat(t,"?$filter=RouteUID%20%20eq%20'").concat(r,"'&$format=JSON"),o.prev=1,o.t0=J.a,o.t1=a,o.next=6,n.getAuthorizationHeader();case 6:return o.t2=o.sent,o.t3={headers:o.t2},o.next=10,o.t0.get.call(o.t0,o.t1,o.t3);case 10:return c=o.sent,o.next=13,c.data;case 13:return o.abrupt("return",o.sent);case 16:o.prev=16,o.t4=o["catch"](1),console.log(o.t4);case 19:case"end":return o.stop()}}),o,null,[[1,16]])})))()},getEstimatedTimeOfTheRoute:function(e,t){var r=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var o,a,c,i,s,u,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=["RouteName","Direction","StopUID","StopName","EstimateTime","StopSequence","PlateNumb"],a=o.join("%2C"),c="https://tdx.transportdata.tw/api/basic/v2/Bus/EstimatedTimeOfArrival/City/".concat(e,"/").concat(t,"?&select=").concat(a,"&$format=JSON"),n.prev=3,n.t0=J.a,n.t1=c,n.next=8,r.getAuthorizationHeader();case 8:return n.t2=n.sent,n.t3={headers:n.t2},n.next=12,n.t0.get.call(n.t0,n.t1,n.t3);case 12:return i=n.sent,i.data.sort((function(e,t){return e.Direction-t.Direction})),s=i.data.filter((function(e){return 0===e.Direction})),u=i.data.filter((function(e){return 1===e.Direction})),l=[s,u],n.next=19,l;case 19:return n.abrupt("return",n.sent);case 22:n.prev=22,n.t4=n["catch"](3),console.log(n.t4);case 25:case"end":return n.stop()}}),n,null,[[3,22]])})))()},sortRealTimeNearStopAndEstimatedTimeByStopsOfTheRoute:function(e,t,r,n){var o=this;return Object(v["a"])(regeneratorRuntime.mark((function a(){var c,i,s,u,l,f,p;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o.getStopsOfTheRoute(t,r,n);case 2:return c=a.sent,a.next=5,o.getEstimatedTimeOfTheRoute(t,r);case 5:return i=a.sent,a.next=8,o.getVehicleNearStopOfTheRoute(t,r);case 8:return s=a.sent,a.t0=_["a"],a.next=12,c;case 12:a.t1=a.sent,u=(0,a.t0)(a.t1),a.prev=14,f=regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return p=l.value,t.next=3,s.filter((function(e){return e.Direction===p.Direction&&p.SubRouteUID===e.SubRouteUID}));case 3:if(r=t.sent,!r){t.next=7;break}return t.next=7,r.forEach(function(){var t=Object(v["a"])(regeneratorRuntime.mark((function t(r){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p.Stops.find((function(e){return r.StopUID===e.StopUID}));case 2:if(n=t.sent,o=e.find((function(e){if(e)return e.PlateNumb===r.PlateNumb})),o&&(r.VehicleType="無障礙公車"),0!==r.A2EventType){t.next=16;break}return t.next=8,n.busDeparture;case 8:if(!t.sent){t.next=12;break}t.t0=[].concat(Object(U["a"])(n.busDeparture),[r]),t.next=13;break;case 12:t.t0=[r];case 13:n.busDeparture=t.t0,t.next=25;break;case 16:if(1!==r.A2EventType){t.next=25;break}return t.next=19,n.busArrival;case 19:if(!t.sent){t.next=23;break}t.t1=[].concat(Object(U["a"])(n.busArrival),[r]),t.next=24;break;case 23:t.t1=[r];case 24:n.busArrival=t.t1;case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 7:if(n=i.find((function(e){return e[0]?e[0].Direction===p.Direction:null})),!n){t.next=11;break}return t.next=11,p.Stops.forEach(function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){var r,o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.find((function(e){return e.StopUID===t.StopUID}));case 2:r=e.sent,r&&(o=r.EstimateTime,a=Math.floor(o/60),t.EstimateTime=void 0==o?"未發車":1===a?"將進站":0===a?"進站中":a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return t.stop()}}),t)})),u.s();case 17:if((l=u.n()).done){a.next=21;break}return a.delegateYield(f(),"t2",19);case 19:a.next=17;break;case 21:a.next=26;break;case 23:a.prev=23,a.t3=a["catch"](14),u.e(a.t3);case 26:return a.prev=26,u.f(),a.finish(26);case 29:return a.abrupt("return",c);case 30:case"end":return a.stop()}}),a,null,[[14,23,26,29]])})))()}}},L=["onClick"],$={class:""},G={key:0,class:"fz20 fw-bold mb4"},Y={class:"color-grey"},V={key:0},W={class:"text-center"},K={class:"color-grey"};function X(e,t,r,o,a,c){var i=Object(n["w"])("FavoriteBtn");return Object(n["r"])(),Object(n["e"])("ul",null,[(Object(n["r"])(!0),Object(n["e"])(n["a"],null,Object(n["v"])(e.routesByKeywords,(function(e,t){return Object(n["r"])(),Object(n["e"])("li",{key:t,class:"px32 cursor-pointer hover-bg-grey"},[Object(n["f"])("div",{onClick:function(t){return c.showChosenRoutePage(e)},class:"flex jc-space-between border-bottom border-color-grey py12"},[Object(n["f"])("div",$,[e.RouteName?(Object(n["r"])(),Object(n["e"])("h6",G,Object(n["y"])(e.RouteName.Zh_tw),1)):Object(n["d"])("",!0),Object(n["f"])("p",Y,[e.DepartureStopNameZh?(Object(n["r"])(),Object(n["e"])("span",V,Object(n["y"])(e.DepartureStopNameZh)+" -",1)):Object(n["d"])("",!0),Object(n["g"])(" "+Object(n["y"])(e.DestinationStopNameZh),1)])]),Object(n["f"])("div",W,[Object(n["h"])(i,{route:e},null,8,["route"]),Object(n["f"])("p",K,Object(n["y"])(e.CityName.slice(0,2)),1)])],8,L)])})),128))])}r("ac1f"),r("5319");var Q={key:0,class:"material-icons mb6 color-secondary"},ee={key:1,class:"material-icons mb6 hover-color-sencodary"};function te(e,t,r,o,a,c){return Object(n["r"])(),Object(n["e"])("div",{onClick:t[0]||(t[0]=Object(n["E"])((function(e){return c.saveToFavorite(!r.route.savedInFavorite,r.route)}),["stop"])),class:"cursor-pointer"},[r.route.savedInFavorite?(Object(n["r"])(),Object(n["e"])("span",Q," favorite ")):(Object(n["r"])(),Object(n["e"])("span",ee," favorite_border "))])}r("a434"),r("e9c4");var re={props:["route"],emit:["saveToFavorite"],methods:{saveToFavorite:function(e,t){var r=localStorage.getItem("favoriteRouteList"),n=r?JSON.parse(r):[];t.savedInFavorite=!!e,this.$emit("saveToFavorite",e),e?n.push({City:t.City,CityName:t.CityName,RouteName:{Zh_tw:t.RouteName.Zh_tw},RouteUID:t.RouteUID,DepartureStopNameZh:t.DepartureStopNameZh,DestinationStopNameZh:t.DestinationStopNameZh,savedInFavorite:!0}):n.find((function(e,r){return e.RouteUID===t.RouteUID&&n.splice(r,1),e.RouteUID===t.RouteUID})),localStorage.setItem("favoriteRouteList",JSON.stringify(n))}}};const ne=j()(re,[["render",te]]);var oe=ne,ae=r("5502"),ce={name:"RouteSearchPanel",data:function(){return{}},computed:Object(H["a"])(Object(H["a"])({},Object(ae["e"])("routes",["keywordsForSearchTheRoute"])),Object(ae["c"])("routes",["routesByKeywords"])),components:{FavoriteBtn:oe},methods:Object(H["a"])(Object(H["a"])(Object(H["a"])(Object(H["a"])({},Object(ae["d"])(["setChosenRoute"])),Object(ae["b"])(["fetchAllDirectionsOfChosenRoute"])),Object(ae["b"])("routes",["fetchGeoJsonOfChosenRoute"])),{},{showChosenRoutePage:function(e){this.setChosenRoute(e),this.fetchAllDirectionsOfChosenRoute(),this.fetchGeoJsonOfChosenRoute(),this.$router.replace({query:{cityOfRoute:e.City,routeName:e.RouteName.Zh_tw,RouteUID:e.RouteUID,DepartureStopNameZh:e.DepartureStopNameZh,DestinationStopNameZh:e.DestinationStopNameZh,CityName:e.City}})}})};const ie=j()(ce,[["render",X]]);var se=ie,ue={key:0,class:"h100 flex flex-direction-column"},le={class:"flex jc-space-between px20 pt20-md mb10-md"},fe={class:"mb24"},pe={class:"text-center fz36 fw-bold"},he={class:"flex jc-space-between cursor-pointer"},be=Object(n["g"])(" 往 "),de={class:"fw-bold"},me=Object(n["g"])(" 往 "),Oe={class:"fw-bold"},ve={class:"h100 overflow-scroll"},ge=["onClick","onMouseover"],we={class:"px32 flex fz14 ai-center"},je={class:"mt12 mb12"},xe={key:0,class:"me8 ml-auto color-secondary"},Re={key:0,class:"material-icons vertical-align-middle"},ye={key:1,class:"me8 ml-auto color-secondary"},Ce={key:0,class:"material-icons vertical-align-middle"},Se={class:"vechileProgressBar"},Ne=Object(n["f"])("div",{class:"bg-color-secondary timeBar",id:"timeBar"},null,-1);function ke(e,t,r,o,a,c){var i=Object(n["w"])("FavoriteBtn");return 0!==Object.keys(e.stopsOfChosenDirection).length?(Object(n["r"])(),Object(n["e"])("div",ue,[Object(n["f"])("div",le,[Object(n["f"])("p",{onClick:t[0]||(t[0]=function(e){return c.backToHomeOrFavorite(r.prePage)}),class:"cursor-pointer"}," ❮ 返回搜尋 "),Object(n["h"])(i,{route:e.chosenRoute,onSaveToFavorite:c.saveToFavorite},null,8,["route","onSaveToFavorite"])]),Object(n["f"])("div",fe,[Object(n["f"])("h3",pe,Object(n["y"])(e.chosenDirection.RouteName.Zh_tw),1)]),Object(n["f"])("ul",he,[Object(n["f"])("li",{onClick:t[1]||(t[1]=function(e){return c.changeDirection(0)}),class:Object(n["n"])(["w50 text-center py10 border-rounded-top",{"bg-primary-color-white":a.direction0Active,"bg-grey400-color-grey900":!a.direction0Active}])},[Object(n["f"])("p",null,[be,Object(n["f"])("span",de,Object(n["y"])(e.chosenDirection.DestinationStopNameZh),1)])],2),Object(n["f"])("li",{onClick:t[2]||(t[2]=function(e){return c.changeDirection(1)}),class:Object(n["n"])(["w50 text-center py10 border-rounded-top",{"bg-primary-color-white":!a.direction0Active,"bg-grey400-color-grey900":a.direction0Active}])},[Object(n["f"])("p",null,[me,Object(n["f"])("span",Oe,Object(n["y"])(e.chosenDirection.DepartureStopNameZh),1)])],2)]),Object(n["f"])("ul",ve,[(Object(n["r"])(!0),Object(n["e"])(n["a"],null,Object(n["v"])(e.stopsOfChosenDirection,(function(t,r){return Object(n["r"])(),Object(n["e"])("li",{key:r,class:"pos-relative cursor-pointer hover-bg-grey",onClick:function(t){return e.setSequenceOfChosenStop(r)},onMouseover:function(t){return e.setSequenceOfChosenStop(r)}},[Object(n["f"])("div",we,[Object(n["f"])("p",{class:Object(n["n"])(["mt12 mb12 border-rounded busNotInService p5 me18 w20 text-center",[{busStopByStop:"將進站"===t.EstimateTime||"進站中"===t.EstimateTime},{busWillStop:"number"===typeof t.EstimateTime}]])},Object(n["y"])(t.EstimateTime),3),Object(n["f"])("p",je,Object(n["y"])(t.StopName.Zh_tw),1),t.busDeparture?(Object(n["r"])(),Object(n["e"])("b",xe,[Object(n["f"])("ul",null,[(Object(n["r"])(!0),Object(n["e"])(n["a"],null,Object(n["v"])(t.busDeparture,(function(e,t){return Object(n["r"])(),Object(n["e"])("li",{key:t},[Object(n["g"])(Object(n["y"])(e.PlateNumb),1),e.VehicleType?(Object(n["r"])(),Object(n["e"])("span",Re," accessible_forward ")):Object(n["d"])("",!0)])})),128))])])):Object(n["d"])("",!0),t.busArrival?(Object(n["r"])(),Object(n["e"])("b",ye,[Object(n["f"])("ul",null,[(Object(n["r"])(!0),Object(n["e"])(n["a"],null,Object(n["v"])(t.busArrival,(function(e,t){return Object(n["r"])(),Object(n["e"])("li",{key:t},[Object(n["g"])(Object(n["y"])(e.PlateNumb),1),e.VehicleType?(Object(n["r"])(),Object(n["e"])("span",Ce," accessible_forward ")):Object(n["d"])("",!0)])})),128))])])):Object(n["d"])("",!0)]),Object(n["f"])("span",Se,[Object(n["f"])("span",{class:Object(n["n"])(["vechileProgressBar-before",[{busArrival:"將進站"===t.EstimateTime||"進站中"===t.EstimateTime},{"visibility-hidden":0===r}]])},null,2),Object(n["f"])("span",{class:Object(n["n"])(["vechileProgressBar-dot",{busStopByStop:"將進站"===t.EstimateTime||"進站中"===t.EstimateTime}])},null,2),Object(n["f"])("span",{class:Object(n["n"])(["vechileProgressBar-after",[{"visibility-hidden":r===e.stopsOfChosenDirection.length-1}]])},null,2)])],40,ge)})),128))]),Ne])):Object(n["d"])("",!0)}var De={data:function(){return{nowDirection:0,direction0Active:!0,updateDataInterval:{},timeBarInterval:{}}},computed:Object(H["a"])(Object(H["a"])(Object(H["a"])({},Object(ae["e"])(["chosenRoute"])),Object(ae["e"])("stops",["allDirectionsOfChosenRoute","sequenceOfChosenStop"])),Object(ae["c"])("stops",["stopsOfChosenDirection","chosenDirection"])),props:["prePage"],emit:["renewFavoriteRoutes"],components:{FavoriteBtn:oe},methods:Object(H["a"])(Object(H["a"])(Object(H["a"])(Object(H["a"])({},Object(ae["d"])(["setAllRoutesOfFavorite","setAllRoutesOfTaiwan"])),Object(ae["d"])("stops",["setIndexOfChosenDirection","setSequenceOfChosenStop"])),Object(ae["b"])(["fetchAllDirectionsOfChosenRoute"])),{},{changeDirection:function(e){this.setIndexOfChosenDirection(e),this.direction0Active=!this.direction0Active},saveToFavorite:function(e){console.log(e),this.setAllRoutesOfFavorite(),this.setAllRoutesOfTaiwan()},backToHomeOrFavorite:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home";"favorite"===e?this.$router.replace({query:{routes:"favorite"}}):this.$router.replace({path:"/"})}}),mounted:function(){var e=this,t=document.getElementById("timeBar").clientWidth,r=t;this.updateDataInterval=setInterval((function(){document.getElementById("timeBar").style.width=t+"px",r=t+t/30,e.fetchAllDirectionsOfChosenRoute(),console.log("=========== NEW DATA +++++++++++++++ ")}),1e4),this.timeBarInterval=setInterval((function(){r-=t/10,document.getElementById("timeBar").style.width=r+"px"}),1e3)},beforeUnmount:function(){clearInterval(this.updateDataInterval),clearInterval(this.timeBarInterval),this.setSequenceOfChosenStop(0),console.log("=========== NO DATA +++++++++++++++")},unmounted:function(){this.setIndexOfChosenDirection(0)}};const Te=j()(De,[["render",ke]]);var Ie=Te,Ae=["id"];function Ee(e,t,r,o,a,c){return Object(n["r"])(),Object(n["e"])("div",{id:r.mapId},null,8,Ae)}r("d81d");var Fe=r("e11e"),Pe=r.n(Fe),Be={name:"Map",props:["mapId"],data:function(){return{map:{},markers:{},layer:Pe.a.layerGroup(this.markers),layerPostalcodes:{},geolayerGroup:{}}},computed:Object(H["a"])(Object(H["a"])(Object(H["a"])({},Object(ae["e"])("stops",["sequenceOfChosenStop"])),Object(ae["e"])("routes",["geoJsonOfChosenRoute"])),Object(ae["c"])("stops",["mapCenter","stopsOfChosenDirection"])),watch:{sequenceOfChosenStop:function(e){void 0!==e&&this.markers[e]&&this.markers[e].openPopup()},geoJsonOfChosenRoute:function(){this.showRouteOnMap(this.geoJsonOfChosenRoute)},stopsOfChosenDirection:function(){var e=this;this.layer.remove();var t=[];this.stopsOfChosenDirection.forEach((function(r){var n="將進站"===r.EstimateTime||"進站中"===r.EstimateTime?"bg-color-secondary":"number"===typeof r.EstimateTime?"bg-color-primary":"bg-color-grey550",o=e.newMarker(r.StopSequence,r.StopPosition.PositionLat,r.StopPosition.PositionLon,n);o.bindPopup("".concat(r.StopName.Zh_tw,"<br><b>").concat(r.EstimateTime,"</b>"),{closeButton:!1,className:n}),t.push(o)})),this.markers=t,this.layer=Pe.a.layerGroup(this.markers),this.layer.addTo(this.map)},mapCenter:{handler:function(){this.map.panTo([this.mapCenter.Lat,this.mapCenter.Lon])},deep:!0}},methods:{initalLeafletMap:function(e,t,r){this.map=Pe.a.map(e,{center:[t,r],zoom:15}),Pe.a.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:25,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoibG9ic3RlcjAxIiwiYSI6ImNrdXdvN3prYTUyYXgyb3BoaThwcmcxN2cifQ.CsAL1uSEtZjpGwuEpYA-6A"}).addTo(this.map)},newMarker:function(e,t,r,n){var o=Pe.a.divIcon({html:'<div class="locationIcon '.concat(n,'"><span>').concat(e,"</span></div>"),iconSize:[20,20],iconAnchor:[0,0],popupAnchor:[10,0]});return Pe.a.marker([t,r],{icon:o,clickable:!0})},showRouteOnMap:function(e){this.map.removeLayer(this.geolayerGroup),this.layerPostalcodes=new Pe.a.GeoJSON(e,{style:{color:"#355F8B",weight:5}}),this.geolayerGroup=new Pe.a.LayerGroup,this.geolayerGroup.addTo(this.map),this.geolayerGroup.addLayer(this.layerPostalcodes)}},mounted:function(){this.initalLeafletMap(this.mapId,this.mapCenter.Lat,this.mapCenter.Lon)}};const He=j()(Be,[["render",Ee]]);var Ue=He,_e={data:function(){return{originalClientY:0,nowClientY:0,windowHeight:0,originalBoardHeight:0,newBoardHeight:0,touchingInfoPanelOrNot:"",nowPage:"home"}},computed:Object(H["a"])(Object(H["a"])(Object(H["a"])(Object(H["a"])(Object(H["a"])(Object(H["a"])({},Object(ae["e"])(["chosenRoute","allRoutesOfFavorite","allRoutesOfTaiwan"])),Object(ae["e"])("stops",["sequenceOfChosenStop"])),Object(ae["e"])("routes",["keywordsForSearchTheRoute","routesOfCurrentPage"])),Object(ae["c"])("routes",["routesByKeywords"])),Object(ae["c"])("stops",["indexOfChosenDirection","stopsOfChosenDirection","chosenDirection","mapCenter","sequenceForCenterMap"])),{},{routeName:{get:function(){return this.keywordsForSearchTheRoute},set:function(e){this.setKeywordsForSearchTheRoute(e)}},signOfEmptyFavoriteRoute:function(){return 0===this.allRoutesOfFavorite.length?"還沒有收藏的站牌YO":""}}),components:{RouteSearchPanel:se,Map:Ue,StopsListPanel:Ie},mixins:[M],watch:{"$route.query":{handler:function(e){this.setAllRoutesOfFavorite(),this.showFavoriteRoutesOrAllRoutesOfTaiwan(),this.setAllRoutesOfTaiwan(),this.nowPage="favorite"===e.routes?"favorite":0===Object.keys(e).length?"home":this.nowPage},deep:!0}},methods:Object(H["a"])(Object(H["a"])(Object(H["a"])(Object(H["a"])(Object(H["a"])(Object(H["a"])({},Object(ae["d"])("stops",["setIndexOfChosenDirection","setSequenceOfChosenStop"])),Object(ae["d"])("routes",["setKeywordsForSearchTheRoute","setRoutesOfCurrentPage","setGeoJsonOfChosenRoute"])),Object(ae["d"])(["setAllRoutesOfTaiwan","setTest","setChosenRoute","setAllDirectionsOfChosenRoute","setIsHomePage","setAllRoutesOfFavorite"])),Object(ae["b"])("routes",["fetchGeoJsonOfChosenRoute"])),Object(ae["b"])(["fetchAllCitiesOfTaiwan","fetchAllRoutesOfTaiwan","fetchAllDirectionsOfChosenRoute"])),{},{renewFavoriteRoutes:function(e,t){var r=this.routesOfCurrentPage.find((function(e){return e.RouteUID===t}));r.savedInFavorite=e},focusInput:function(e){document.getElementById(e).focus()},setOriginalClientY:function(e){this.originalClientY=e.touches?e.touches[0].clientY:e.clientY,this.touchingInfoPanelOrNot=!0},changeTargetHeight:function(e){this.touchingInfoPanelOrNot&&(this.nowClientY=e.changedTouches?e.changedTouches[0].clientY:e.clientY,this.originalBoardHeight=document.getElementById("infoPanel").offsetHeight,this.newBoardHeight=this.originalBoardHeight+(this.originalClientY-this.nowClientY),document.getElementById("infoPanel").style.height=this.newBoardHeight>=this.windowHeight?this.windowHeight+"px":this.newBoardHeight<=200?"200px":this.newBoardHeight+"px",this.originalClientY=this.nowClientY)},changeDirectionForMap:function(e){this.setIndexOfChosenDirection(e)},showRoutes:function(){this.deselectChosenRoute(),this.setChosenRoute({}),this.setAllDirectionsOfChosenRoute([])},showFavoriteRoutesOrAllRoutesOfTaiwan:function(){var e=this;return Object(v["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:"favorite"===e.$route.query.routes?(e.setIsHomePage(!1),e.showRoutes()):0===Object.keys(e.$route.query).length&&(e.setIsHomePage(!0),e.showRoutes());case 1:case"end":return t.stop()}}),t)})))()},deselectChosenRoute:function(){this.routeName="",this.chosenDirectionOfChosenRoute=[]},saveFavoriteRoutesFromLocalStorage:function(){var e=this,t=localStorage.getItem("favoriteRouteList");this.allRoutesOfFavorite=t?JSON.parse(t):[],this.allRoutesOfFavorite.forEach((function(t){var r=e.allRoutesOfTaiwan.filter((function(e){return e.RouteUID===t.RouteUID}));r[0]&&(r[0].savedInFavorite=!0)}))},showStopsOfSpecificRouteOrNot:function(){return this.$route.query.cityOfRoute&&this.$route.query.routeName&&this.$route.query.RouteUID&&this.$route.query.DepartureStopNameZh&&this.$route.query.DestinationStopNameZh&&this.$route.query.CityName}}),mounted:function(){this.windowHeight=document.getElementById("infoPanel").offsetHeight/.9},created:function(){this.setTest(),this.fetchAllRoutesOfTaiwan(),this.showFavoriteRoutesOrAllRoutesOfTaiwan(),this.showStopsOfSpecificRouteOrNot()&&this.getStopsOfRoute({})}};const Ze=j()(_e,[["render",B]]);var qe=Ze,ze=[{path:"/",name:"Home",component:qe}],Je=Object(y["a"])({history:Object(y["b"])("/taiwan_bus/"),routes:ze}),Me=Je,Le=(r("00b4"),{indexOfChosenDirection:0,sequenceOfChosenStop:0}),$e={mapCenter:function(e,t){return{Lat:t.stopsOfChosenDirection[t.sequenceForCenterMap]?t.stopsOfChosenDirection[t.sequenceForCenterMap].StopPosition.PositionLat:"22.997572",Lon:t.stopsOfChosenDirection[t.sequenceForCenterMap]?t.stopsOfChosenDirection[t.sequenceForCenterMap].StopPosition.PositionLon:"120.196029"}},sequenceForCenterMap:function(e,t){return void 0===e.sequenceOfChosenStop?parseInt(t.stopsOfChosenDirection.length/2):e.sequenceOfChosenStop},stopsOfChosenDirection:function(e,t,r){return console.log(r.chosenRoute,t.chosenDirection.Stops?t.chosenDirection.Stops:[]),t.chosenDirection.Stops?t.chosenDirection.Stops:[]},chosenDirection:function(e,t,r){return r.allDirectionsOfChosenRoute[e.indexOfChosenDirection]?r.allDirectionsOfChosenRoute[e.indexOfChosenDirection]:[]}},Ge={},Ye={setIndexOfChosenDirection:function(e,t){e.indexOfChosenDirection=t},setSequenceOfChosenStop:function(e,t){e.sequenceOfChosenStop=t}},Ve={namespaced:!0,state:Le,getters:$e,actions:Ge,mutations:Ye},We=(r("4d63"),r("c607"),r("2c3e"),{getCityList:function(){var e=this;return Object(v["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="https://tdx.transportdata.tw/api/basic/v2/Basic/City?%24format=JSON",t.prev=1,t.t0=J.a,t.t1=r,t.next=6,e.getAuthorizationHeader();case 6:return t.t2=t.sent,t.t3={headers:t.t2},t.next=10,t.t0.get.call(t.t0,t.t1,t.t3);case 10:return n=t.sent,t.next=13,n.data;case 13:return t.abrupt("return",t.sent);case 16:t.prev=16,t.t4=t["catch"](1),console.log("台灣所有縣市的名稱",t.t4);case 19:case"end":return t.stop()}}),t,null,[[1,16]])})))()},getAuthorizationHeader:function(){return Object(v["a"])(regeneratorRuntime.mark((function e(){var t,r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={grant_type:"client_credentials",client_id:"shooboost-0659506a-9440-4f49",client_secret:"f075a3b1-3567-47d5-9926-e413ba6d3d42"},r="https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",e.prev=2,e.next=5,J()({method:"POST",url:r,data:q.a.stringify(t),headers:{"content-type":"application/x-www-form-urlencoded"}});case 5:return n=e.sent,o=n.data,e.abrupt("return",{authorization:"Bearer ".concat(o.access_token)});case 10:return e.prev=10,e.t0=e["catch"](2),e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))()},getRoutesOfTheCity:function(e,t){var r=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var o,a,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o="https://tdx.transportdata.tw/api/basic/v2/Bus/Route/City/".concat(e,"?$format=JSON"),n.prev=1,n.t0=J.a,n.t1="".concat(o),n.next=6,r.getAuthorizationHeader();case 6:return n.t2=n.sent,n.t3={headers:n.t2},n.next=10,n.t0.get.call(n.t0,n.t1,n.t3);case 10:return a=n.sent,c=[],a.data.forEach((function(e){c.push({City:e.City,CityName:t,CityCode:e.CityCode,RouteUID:e.RouteUID,RouteMapImageUrl:e.RouteMapImageUrl,RouteName:e.RouteName,DepartureStopNameEn:e.DepartureStopNameEn,DepartureStopNameZh:e.DepartureStopNameZh,DestinationStopNameEn:e.DestinationStopNameEn,DestinationStopNameZh:e.DestinationStopNameZh})})),n.next=15,c;case 15:return n.abrupt("return",n.sent);case 18:n.prev=18,n.t4=n["catch"](1),console.log(n.t4);case 21:case"end":return n.stop()}}),n,null,[[1,18]])})))()},getRoutesOfTaiwan:function(e){var t=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var n,o,a,c,i,s,u,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=[],o=[],a=Object(_["a"])(e),r.prev=3,a.s();case 5:if((c=a.n()).done){r.next=14;break}return i=c.value,r.t0=o,r.next=10,t.getRoutesOfTheCity(i.City,i.CityName);case 10:r.t1=r.sent,r.t0.push.call(r.t0,r.t1);case 12:r.next=5;break;case 14:r.next=19;break;case 16:r.prev=16,r.t2=r["catch"](3),a.e(r.t2);case 19:return r.prev=19,a.f(),r.finish(19);case 22:s=0,u=o;case 23:if(!(s<u.length)){r.next=33;break}return l=u[s],r.t3=n,r.next=28,l;case 28:r.t4=r.sent,n=r.t3.concat.call(r.t3,r.t4);case 30:s++,r.next=23;break;case 33:return n.sort((function(e,t){return e.RouteName.Zh_tw.localeCompare(t.RouteName.Zh_tw,"zh-TW")})),r.next=36,n;case 36:return r.abrupt("return",r.sent);case 37:case"end":return r.stop()}}),r,null,[[3,16,19,22]])})))()},getVehicleNearStopOfTheRoute:function(e,t){var r=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var o,a,c,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=["RouteName","Direction","RouteUID","StopUID","PlateNumb","A2EventType","StopName","SubRouteUID"],a=o.join("%2C"),c="https://tdx.transportdata.tw/api/basic/v2/Bus/RealTimeNearStop/City/".concat(e,"/").concat(t,"?$select=").concat(a,"&$format=JSON"),n.prev=3,n.t0=J.a,n.t1="".concat(c),n.next=8,r.getAuthorizationHeader();case 8:return n.t2=n.sent,n.t3={headers:n.t2},n.next=12,n.t0.get.call(n.t0,n.t1,n.t3);case 12:return i=n.sent,n.next=15,i.data;case 15:return n.abrupt("return",n.sent);case 18:n.prev=18,n.t4=n["catch"](3),console.log(n.t4);case 21:case"end":return n.stop()}}),n,null,[[3,18]])})))()},getVehicleOfTheCity:function(e){var t=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n="https://tdx.transportdata.tw/api/basic/v2/Bus/Vehicle/City/".concat(e,"?$filter=VehicleType%20eq%201&$format=JSON/"),r.prev=1,r.t0=J.a,r.t1="".concat(n),r.next=6,t.getAuthorizationHeader();case 6:return r.t2=r.sent,r.t3={headers:r.t2},r.next=10,r.t0.get.call(r.t0,r.t1,r.t3);case 10:return o=r.sent,r.next=13,o.data;case 13:return r.abrupt("return",r.sent);case 16:r.prev=16,r.t4=r["catch"](1),console.log(r.t4);case 19:case"end":return r.stop()}}),r,null,[[1,16]])})))()},getVehicleOfTaiwan:function(e){var t=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var n,o,a,c,i,s,u,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=[],o=[],a=Object(_["a"])(e),r.prev=3,a.s();case 5:if((c=a.n()).done){r.next=16;break}if(i=c.value,"Chiayi"!==i.City){r.next=9;break}return r.abrupt("continue",14);case 9:return r.t0=o,r.next=12,t.getVehicleOfTheCity(i.City);case 12:r.t1=r.sent,r.t0.push.call(r.t0,r.t1);case 14:r.next=5;break;case 16:r.next=21;break;case 18:r.prev=18,r.t2=r["catch"](3),a.e(r.t2);case 21:return r.prev=21,a.f(),r.finish(21);case 24:s=0,u=o;case 25:if(!(s<u.length)){r.next=35;break}return l=u[s],r.t3=n,r.next=30,l;case 30:r.t4=r.sent,n=r.t3.concat.call(r.t3,r.t4);case 32:s++,r.next=25;break;case 35:return r.next=37,n;case 37:return r.abrupt("return",r.sent);case 38:case"end":return r.stop()}}),r,null,[[3,18,21,24]])})))()},getRouteGEOJSON:function(e,t){var r=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o="https://tdx.transportdata.tw/api/basic/V3/Map/Bus/Network/StopOfRoute/City/".concat(e,"/RouteName/").concat(t,"?%24format=GEOJSON"),n.prev=1,n.t0=J.a,n.t1="".concat(o),n.next=6,r.getAuthorizationHeader();case 6:return n.t2=n.sent,n.t3={headers:n.t2},n.next=10,n.t0.get.call(n.t0,n.t1,n.t3);case 10:return a=n.sent,console.log("getRouteGEOJSON 拿到 tdx data 啦",o,a.data),n.abrupt("return",a.data.features[0]);case 15:n.prev=15,n.t4=n["catch"](1),console.log(n.t4);case 18:case"end":return n.stop()}}),n,null,[[1,15]])})))()},getStopsOfTheRoute:function(e,t,r){var n=this;return Object(v["a"])(regeneratorRuntime.mark((function o(){var a,c;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a="https://tdx.transportdata.tw/api/basic/v2/Bus/StopOfRoute/City/".concat(e,"/").concat(t,"?$filter=RouteUID%20%20eq%20'").concat(r,"'&$format=JSON"),o.prev=1,o.t0=J.a,o.t1=a,o.next=6,n.getAuthorizationHeader();case 6:return o.t2=o.sent,o.t3={headers:o.t2},o.next=10,o.t0.get.call(o.t0,o.t1,o.t3);case 10:return c=o.sent,o.next=13,c.data;case 13:return o.abrupt("return",o.sent);case 16:o.prev=16,o.t4=o["catch"](1),console.log(o.t4);case 19:case"end":return o.stop()}}),o,null,[[1,16]])})))()},getEstimatedTimeOfTheRoute:function(e,t){var r=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var o,a,c,i,s,u,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=["RouteName","Direction","StopUID","StopName","EstimateTime","StopSequence","PlateNumb"],a=o.join("%2C"),c="https://tdx.transportdata.tw/api/basic/v2/Bus/EstimatedTimeOfArrival/City/".concat(e,"/").concat(t,"?&select=").concat(a,"&$format=JSON"),n.prev=3,n.t0=J.a,n.t1=c,n.next=8,r.getAuthorizationHeader();case 8:return n.t2=n.sent,n.t3={headers:n.t2},n.next=12,n.t0.get.call(n.t0,n.t1,n.t3);case 12:return i=n.sent,i.data.sort((function(e,t){return e.Direction-t.Direction})),s=i.data.filter((function(e){return 0===e.Direction})),u=i.data.filter((function(e){return 1===e.Direction})),l=[s,u],n.next=19,l;case 19:return n.abrupt("return",n.sent);case 22:n.prev=22,n.t4=n["catch"](3),console.log(n.t4);case 25:case"end":return n.stop()}}),n,null,[[3,22]])})))()},sortRealTimeNearStopAndEstimatedTimeByStopsOfTheRoute:function(e,t,r,n){var o=this;return Object(v["a"])(regeneratorRuntime.mark((function a(){var c,i,s,u,l,f,p;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o.getStopsOfTheRoute(t,r,n);case 2:return c=a.sent,a.next=5,o.getEstimatedTimeOfTheRoute(t,r);case 5:return i=a.sent,a.next=8,o.getVehicleNearStopOfTheRoute(t,r);case 8:return s=a.sent,a.t0=_["a"],a.next=12,c;case 12:a.t1=a.sent,u=(0,a.t0)(a.t1),a.prev=14,f=regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return p=l.value,t.next=3,s.filter((function(e){return e.Direction===p.Direction&&p.SubRouteUID===e.SubRouteUID}));case 3:if(r=t.sent,!r){t.next=7;break}return t.next=7,r.forEach(function(){var t=Object(v["a"])(regeneratorRuntime.mark((function t(r){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p.Stops.find((function(e){return r.StopUID===e.StopUID}));case 2:if(n=t.sent,o=e.find((function(e){if(e)return e.PlateNumb===r.PlateNumb})),o&&(r.VehicleType="無障礙公車"),0!==r.A2EventType){t.next=16;break}return t.next=8,n.busDeparture;case 8:if(!t.sent){t.next=12;break}t.t0=[].concat(Object(U["a"])(n.busDeparture),[r]),t.next=13;break;case 12:t.t0=[r];case 13:n.busDeparture=t.t0,t.next=25;break;case 16:if(1!==r.A2EventType){t.next=25;break}return t.next=19,n.busArrival;case 19:if(!t.sent){t.next=23;break}t.t1=[].concat(Object(U["a"])(n.busArrival),[r]),t.next=24;break;case 23:t.t1=[r];case 24:n.busArrival=t.t1;case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 7:if(n=i.find((function(e){return e[0]?e[0].Direction===p.Direction:null})),!n){t.next=11;break}return t.next=11,p.Stops.forEach(function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){var r,o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.find((function(e){return e.StopUID===t.StopUID}));case 2:r=e.sent,r&&(o=r.EstimateTime,a=Math.floor(o/60),t.EstimateTime=void 0==o?"未發車":1===a?"將進站":0===a?"進站中":a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return t.stop()}}),t)})),u.s();case 17:if((l=u.n()).done){a.next=21;break}return a.delegateYield(f(),"t2",19);case 19:a.next=17;break;case 21:a.next=26;break;case 23:a.prev=23,a.t3=a["catch"](14),u.e(a.t3);case 26:return a.prev=26,u.f(),a.finish(26);case 29:return a.abrupt("return",c);case 30:case"end":return a.stop()}}),a,null,[[14,23,26,29]])})))()}}),Ke={keywordsForSearchTheRoute:"",geoJsonOfChosenRoute:{}},Xe={routesByKeywords:function(e,t){var r=[],n=new RegExp(e.keywordsForSearchTheRoute);return t.routesOfCurrentPage.forEach((function(e){n.test(e.RouteName.Zh_tw+"*")&&r.push(e)})),r},routesOfCurrentPage:function(e,t,r){return r.isHomePage?r.allRoutesOfTaiwan:r.allRoutesOfFavorite}},Qe={setKeywordsForSearchTheRoute:function(e,t){e.keywordsForSearchTheRoute=t},setRoutesOfCurrentPage:function(e,t){e.routesOfCurrentPage=t},setGeoJsonOfChosenRoute:function(e,t){e.geoJsonOfChosenRoute=t}},et={fetchGeoJsonOfChosenRoute:function(e){return Object(v["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,We.getRouteGEOJSON(e.rootState.chosenRoute.City,e.rootState.chosenRoute.RouteName.Zh_tw);case 3:t.t1=t.sent,t.t0.commit.call(t.t0,"setGeoJsonOfChosenRoute",t.t1);case 5:case"end":return t.stop()}}),t)})))()}},tt={namespaced:!0,state:Ke,getters:Xe,actions:et,mutations:Qe},rt=Object(ae["a"])({state:{allCitiesOfTaiwan:[],allRoutesOfTaiwan:[],allRoutesOfTaiwanWithoutFavorite:[],allRoutesOfFavorite:[],chosenRoute:{},allDirectionsOfChosenRoute:[],isHomePage:!0,test:{a:[0,0,0],b:[1,1,1]}},getters:{},mutations:{setTest:function(e){e.test.a[0]="change"},setAllRoutesOfFavorite:function(e){var t=localStorage.getItem("favoriteRouteList");e.allRoutesOfFavorite=t?JSON.parse(t):[]},setChosenRoute:function(e,t){e.chosenRoute=t},setAllDirectionsOfChosenRoute:function(e,t){e.allDirectionsOfChosenRoute=t},setAllCitiesOfTaiwan:function(e,t){e.allCitiesOfTaiwan=t},setAllRoutesOfTaiwanWithoutFavorite:function(e,t){e.allRoutesOfTaiwanWithoutFavorite=t},setAllRoutesOfTaiwan:function(e){e.allRoutesOfTaiwan=JSON.parse(JSON.stringify(e.allRoutesOfTaiwanWithoutFavorite)),e.allRoutesOfFavorite.forEach((function(t){var r=e.allRoutesOfTaiwan.find((function(e){return e.RouteUID===t.RouteUID}));r&&(r.savedInFavorite=!0)}))},setIsHomePage:function(e,t){e.isHomePage=t}},actions:{fetchAllCitiesOfTaiwan:function(e){return Object(v["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,We.getCityList();case 3:t.t1=t.sent,t.t0.commit.call(t.t0,"setAllCitiesOfTaiwan",t.t1);case 5:case"end":return t.stop()}}),t)})))()},fetchAllRoutesOfTaiwan:function(e){return Object(v["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.commit("setAllRoutesOfFavorite"),t.next=3,e.dispatch("fetchAllCitiesOfTaiwan");case 3:return t.t0=We,t.next=6,e.state.allCitiesOfTaiwan;case 6:return t.t1=t.sent,t.next=9,t.t0.getRoutesOfTaiwan.call(t.t0,t.t1);case 9:return r=t.sent,t.next=12,e.commit("setAllRoutesOfTaiwanWithoutFavorite",r);case 12:return t.next=14,e.commit("setAllRoutesOfTaiwan");case 14:case"end":return t.stop()}}),t)})))()},fetchAllDirectionsOfChosenRoute:function(e){return Object(v["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=We,t.next=3,We.getVehicleOfTaiwan(e.state.allCitiesOfTaiwan);case 3:return t.t1=t.sent,t.t2=e.state.chosenRoute.City,t.t3=e.state.chosenRoute.RouteName.Zh_tw,t.t4=e.state.chosenRoute.RouteUID,t.next=9,t.t0.sortRealTimeNearStopAndEstimatedTimeByStopsOfTheRoute.call(t.t0,t.t1,t.t2,t.t3,t.t4);case 9:return r=t.sent,t.next=12,r.forEach((function(t){t.DepartureStopNameZh=e.state.chosenRoute.DepartureStopNameZh,t.DestinationStopNameZh=e.state.chosenRoute.DestinationStopNameZh,t.CityName=e.state.chosenRoute.CityName,t.savedInFavorite=e.state.chosenRoute.savedInFavorite}));case 12:return t.t5=e,t.next=15,r;case 15:t.t6=t.sent,t.t5.commit.call(t.t5,"setAllDirectionsOfChosenRoute",t.t6);case 17:case"end":return t.stop()}}),t)})))()}},modules:{stops:Ve,routes:tt}});Object(n["c"])(R).use(rt).use(Me).mount("#app")},ebf0:function(e,t,r){"use strict";r("5280")}});
//# sourceMappingURL=app.a3a2e0da.js.map